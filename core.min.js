/**
* Core Framework
* http://code.google.com/p/core-framework/
* 
* @version 1.0.0
* @copyright Creozon
* @author Angel Kostadinov
*/
(function(){var h=this,enumerables=true,enumerablesTest={toString:1}this.Core=function(){}for(i in enumerablesTest){enumerables=null}if(enumerables){enumerables=['hasOwnProperty','valueOf','isPrototypeOf','propertyIsEnumerable','toLocaleString','toString','constructor']}Core.apply=function(a,b,c){if(c){Ext.apply(a,c)}if(a&&b&&typeof b==='object'){var i,j,k;for(i in b){a[i]=b[i]}if(enumerables){for(j=enumerables.length;j--;){k=enumerables[j];if(b.hasOwnProperty(k)){a[k]=b[k]}}}}else if(a&&b&&typeof b==='function'&&b.prototype){arguments.callee.apply(this,[a,b.prototype,c])}return a}Core.delegate=function(b,c,d){return(typeof c=="function")?function(){arguments.push=Array.prototype.push;for(var a in d){arguments.push(d[a])}return c.apply(b,arguments)}:function(){return false}}Core.extend=function(b){Core.constructing=true;var c=new this();delete Core.constructing;Core.apply(c,b);function Class(){if(!Core.constructing&&this.init){this.init.apply(this,arguments)}if(!Core.constructing&&this.mixins){for(var a in this.mixins){Core.apply(this,this.mixins[a])}}}Class.prototype=c;Class.constructor=Class;Class.extend=arguments.callee;Class.prototype.delegate=Core.delegate;return Class}Core.apply(Core,{namespace:(function(){return{register:function(a,b,c){var d=a.split('.');for(var i in d){var a=d[i];if(!this.exists(a,b)){b[a]=c}b=b[a]}return b},exists:function(a,b){return typeof b[a]==="undefined"?false:true}}})(),define:function(a,b){return this.namespace.register(a,window,b)},loader:(function(){var f={}var g=[],counter=0;return{addScripts:function(a){f=$.extend(true,{},f,a);return this},loadScript:function(a,b,c){var d=g[a]||(g[a]={loaded:false,callbacks:[]});if(d.loaded){return b.apply(c)}d.callbacks.push({fn:b,context:c});if(d.callbacks.length==1){$.ajax({type:'GET',url:a+'.js',dataType:'script',cache:false,success:function(){d.loaded=true;$.each(d.callbacks,function(){this.fn.apply(this.context)});d.callbacks.length=0}})}},queue:function(){var e=function(a){if(-1==$.inArray(a,g)){g.push(a)}}$.each(f,function(c,d){$.each(d,function(a,b){e(b)});e(c)});return this},autoload:function(a){this.queue();(function(){if(counter==g.length){return a.apply(window)}Core.loader.loadScript(g[counter++],arguments.callee)})()}}})()});Core.apply(Array.prototype,{each:Array.prototype.forEach,clear:function(){this.length=0;return this},shuffle:function(){for(var j,x,i=this.length;i;j=parseInt(Math.random()*i),x=this[--i],this[i]=this[j],this[j]=x);return this},invoke:function(b){var c=Array.prototype.slice.call(arguments,1);return this.map(function(a){return a[b].apply(a,c)})}})})();Core.define('Core.Class',Core.extend({}));Core.define('Core.data',Core.Class.extend({init:function(a){Core.apply(this,a)}}));Core.define('Core.data.FileUpload',Core.data.extend({form:null,iframe:null,listeners:{before:function(a,b){},success:function(a,b){}},options:{id:"myAjaxUpload"},complete:function(a,b){this.getForm().removeAttr('target');var c=$.parseJSON(b.text());this.listeners.success.apply(this,[a,c])},loaded:function(a){if(this.iframe.contents().attr("location")=="about:blank"){return}this.iframe.trigger("complete",[this.iframe.contents()]);return false},upload:function(){this.listeners.before.apply(this,[{}]);return this.getForm().attr("target",this.options.id).trigger("submit")},submit:function(){return true},getFileInput:function(){var a=(new Date().getTime());return $('<input/>',{id:a,name:"file"}).attr({type:"file"}).bind('change',this.delegate(this,this.upload))},getForm:function(){if(!this.form){this.form=$(this.renderTo).parents('form:first')}return this.form},render:function(){this.iframe=$('<iframe />',{id:this.options.id,name:this.options.id,scr:"about:blank"}).hide().load(this.delegate(this,this.loaded)).bind("complete",this.delegate(this,this.complete)).appendTo(document.body);if($.browser.msie){document.frames[this.options.id].name=this.options.id}this.getFileInput().appendTo(this.renderTo)},renderTo:null}));Core.define('Core.animation',Core.Class.extend({options:{speed:300,easing:'linear'},animationQueue:[],listeners:{complete:function(a,b){}},init:function(a){this.options=$.extend(true,{},this.options,a)},queue:function(a,b,c){this.animationQueue.push({item:a,callback:c,animation:$.extend(true,{},b)});return this},reset:function(){this.animationQueue=[];return this},animate:function(){for(i=0;i<this.animationQueue.length;i++){var a=i==this.animationQueue.length-1?this.listeners.complete:this.animationQueue[i].callback;this.animationQueue[i].item.animate(this.animationQueue[i].animation,this.options.speed,this.options.easing,a)}this.reset()},addListener:function(a,b){this.listeners[a]=b}}))Core.define('Core.element',Core.data.extend({element:null,init:function(a,b){this.element=a;Core.apply(this,b)},replace:function(){}}));Core.define('Core.element.input',Core.element.extend({replace:function(a){return(new Core.element[this.element.attr('type').toLowerCase()](this.element)).replace({theme:a.theme})}}));Core.define('Core.element.checkbox',Core.element.extend({options:{theme:{},placeholder:null},listeners:{click:function(a,b){}},click:function(){if(this.element.attr('checked')){this.placeholder.find('a').removeClass('checked');this.element.attr('checked',false)}else{this.placeholder.find('a').addClass('checked');this.element.attr('checked',true)}return false},placeholder:function(){if(!this.options.placeholder){this.options.placeholder={element:function(a){var b=$('<div/>').addClass('ui-form-checkbox').addClass(this.options.theme.classes.checkbox).bind({click:this.delegate(this,this.click)});var C=$('<a/>').appendTo(b);if(this.element.attr('checked')){C.addClass('checked')}return b},update:function(a){var b=$('label[for='+this.element.attr('id')+']');this.element.add(b).hide();this.placeholder.append(b.text())}}}this.placeholder=this.options.placeholder.element.apply(this,[this.element]);this.options.placeholder.update.apply(this,[this.placeholder]);return this.placeholder},update:function(a,b,c){if($(b).val()==c.val()){$(b).attr('selected',true);this.placeholder.find(':text').val($(b).text());this.element.trigger('onchange');this.listeners.change.apply(this,[])}else{$(b).attr('selected',false)}},replace:function(a){this.options=$.extend(true,{},this.options,a);this.placeholder().insertAfter(this.element)}}));Core.define('Core.element.select',Core.element.extend({options:{theme:{},placeholder:null},listeners:{select:function(a,b){},change:function(a,b){}},animation:new Core.animation({speed:100}),open:function(a){this.closeAll();var b=$('<div/>').addClass('ui-form-select-dropdown').addClass(this.options.theme.classes.dropdown).css($.extend({position:'absolute',top:this.placeholder.offset().top+this.placeholder.height(),left:this.placeholder.offset().left,width:this.placeholder.outerWidth()-4},this.options.theme.css)).appendTo(document.body);if($('option',this.element).length>this.options.theme.options.limit){b.css({height:this.options.theme.options.maxHeight,overflow:'auto'})}$('option',this.element).each(this.delegate(this,this.collect,[b]));this.animation.reset().queue(b,{height:"show"}).animate();$(document).bind('mousedown',this.delegate(this,this.forceClose))},close:function(a,b){this.animation.queue($(b),{height:"hide"},function(){$(this).remove()})},closeAll:function(){$(document.body).children('.ui-form-select-dropdown').each(this.delegate(this,this.close));this.animation.animate()},forceClose:function(a){var b=$(a.target).parents('.ui-form-select-dropdown').length;if(!b&&!$(a.target).is('.ui-form-select-dropdown')){this.closeAll()}},placeholder:function(){if(!this.options.placeholder){this.options.placeholder={element:function(a){var b=$('<div/>').addClass('ui-form-select').addClass(this.options.theme.classes.select).bind({mouseenter:this.delegate(this,this.mouse.over),mouseleave:this.delegate(this,this.mouse.out),click:this.delegate(this,this.open)});var c=$('<div/>').appendTo(b),input=$('<input/>',{type:"text"}).css({cursor:'pointer',width:100+'%',background:'none',border:'none'}).appendTo(c).val();var d=$('<span/>').addClass('ui-form-select-arrow').appendTo(b);return b},update:function(a){a.find(':text').val(this.element.find('option:selected').text())}}}this.placeholder=this.options.placeholder.element.apply(this,[this.element]);this.options.placeholder.update.apply(this,[this.placeholder]);return this.placeholder},update:function(a,b,c){if($(b).val()==c.val()){$(b).attr('selected',true);this.placeholder.find(':text').val($(b).text());this.element.trigger('onchange');this.listeners.change.apply(this,[])}else{$(b).attr('selected',false)}},selectOption:function(a){this.element.find('option').each(this.delegate(this,this.update,[$(a.target).data('option')]));this.closeAll()},mouse:{over:function(a){this.placeholder.addClass(this.options.theme.classes.selectOver)},out:function(a){this.placeholder.removeClass(this.options.theme.classes.selectOver)}},collect:function(a,b,c){var d=$('<a/>',{title:$(b).text()}).data('option',$(b)).appendTo(c).bind('click',this.delegate(this,this.selectOption)).html($(b).text());if($(b).attr('selected')){this.placeholder.find(':text').val($(b).text());d.addClass('ui-form-select-option-selected')}},replace:function(a){this.options=$.extend(true,{},this.options,a);this.placeholder().insertAfter(this.element)}}));Core.define('Core.forms',Core.Class.extend({options:{applyTo:null,theme:{options:{limit:20,maxHeight:320},classes:{arrow:'ui-form-select-arrow',select:'ui-form-select',selectOver:'ui-form-select-over',selected:'ui-form-select-option-selected',dropdown:'ui-form-select-dropdown'},effect:'slide',timeout:300},speed:300},applyTheme:function(){if(this.options.applyTo){var a=$(this.options.applyTo);$('select',a).add(':checkbox',a).each(this.delegate(this,this.replace))}},replace:function(a,b){var c=b.tagName.toLowerCase();return(new Core.element[c]($(b))).replace({theme:this.options.theme})},init:function(a){this.options=$.extend(true,{},this.options,a)}}));